<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>××©×—×§ ×˜×¨×™×•×•×™×” - ××•×¦×¨ ××™×œ×™×</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 10px;
      text-align: center;
    }
    /* Game container styling */
    .container {
      max-width: 600px;
      margin: 60px auto 20px auto; /* Adds top margin so the hamburger icon is visible */
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      margin-top: 0;
    }
    .question {
      font-size: 1em;
      margin-bottom: 20px;
    }
    .options {
      list-style: none;
      padding: 0;
    }
    .options li {
      margin: 10px 0;
    }
    button.option-btn {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button.option-btn:hover {
      opacity: 0.9;
    }
    .correct {
      background-color: #4CAF50 !important;
      color: white;
    }
    .wrong {
      background-color: #f44336 !important;
      color: white;
    }
    .progress, .score {
      margin: 15px 0;
      font-size: 1em;
    }
    .message {
      font-size: 1em;
      margin-top: 20px;
    }
    .restart-btn {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 20px;
      border: none;
      border-radius: 5px;
      background-color: #2196F3;
      color: white;
      cursor: pointer;
    }
    /* Hamburger menu styling */
    #hamburgerMenu {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 30px;
      cursor: pointer;
      z-index: 1001;
    }
    /* Vocabulary upload panel styling (hidden by default) */
    #uploadPanel {
      position: fixed;
      top: 0;
      right: 0;
      width: 300px;
      height: 100%;
      background-color: #e7f3fe;
      border-left: 1px solid #b3d7ff;
      box-shadow: -2px 0 5px rgba(0,0,0,0.3);
      padding: 15px;
      display: none;
      z-index: 1000;
      overflow-y: auto;
    }
    #uploadPanel h2 {
      margin-top: 0;
    }
    #uploadPanel label {
      display: block;
      margin-top: 8px;
    }
    #uploadPanel input, #uploadPanel select {
      padding: 5px;
      margin-top: 5px;
      width: 90%;
      max-width: 250px;
    }
    #uploadPanel button {
      margin-top: 10px;
      padding: 8px 15px;
      font-size: 1em;
      cursor: pointer;
    }
    /* Close icon for the upload panel */
    #closeUploadPanel {
      font-size: 24px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      left: 10px;
    }
  </style>
</head>
<body>
  <!-- Hamburger menu icon -->
  <div id="hamburgerMenu">â˜°</div>

  <!-- Vocabulary upload panel (hidden by default) -->
  <div id="uploadPanel">
    <span id="closeUploadPanel">âœ–</span>
    <h2>× ×™×”×•×œ ××•×¦×¨ ××™×œ×™×</h2>
    <label for="vocabName">×©× ×¡×˜ ××•×¦×¨ ××™×œ×™×:</label>
    <input type="text" id="vocabName" placeholder="×”×–×Ÿ ×©× ×¡×˜">
    
    <label for="vocabUpload">×‘×—×¨ ×§×•×‘×¥ ××•×¦×¨ ××™×œ×™× (JSON):</label>
    <input type="file" id="vocabUpload" accept=".json">
    
    <br>
    <button id="loadVocabBtn">×”×¢×œ×” ×¡×˜ ×—×“×©</button>
    
    <br><br>
    <label for="vocabSelect">×‘×—×¨ ×¡×˜ ××•×¦×¨ ××™×œ×™×:</label>
    <select id="vocabSelect"></select>
  </div>

  <!-- Trivia game container -->
  <div class="container">
    <h1>××©×—×§ ×˜×¨×™×•×•×™×”</h1>
    <div class="progress">×©××œ×” <span id="currentQuestion">0</span> ××ª×•×š <span id="totalQuestions">10</span></div>
    <div class="score">× ×™×§×•×“: <span id="score">0</span></div>
    <div class="question" id="questionText">×©××œ×” ×ª×•×¤×™×¢ ×›××Ÿ</div>
    <ul class="options" id="optionsList">
      <!-- Answer options will be inserted here -->
    </ul>
    <div class="message" id="feedbackMessage"></div>
    <button class="restart-btn" id="restartBtn" style="display:none;">×”×ª×—×œ ××—×“×©</button>
  </div>

  <script>
    // Global variables for speech synthesis
    let soundEnabled = true;           // Default state: sound on
    let currentDisplayedWord = "";     // Holds the current English word

    // Function to speak a word using the Web Speech API
    function speakWord(word) {
      if (!soundEnabled) return; // Do nothing if muted
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }

    /*********************************************************************
     * Vocabulary Definitions (default vocabulary with 62 entries)
     *********************************************************************/
    const defaultVocabulary = [
      { english: "autumn",       hebrew: "×¡×ª×™×•",          options: ["×¡×ª×™×•", "××‘×™×‘", "×§×™×¥", "×—×•×¨×£"] },
      { english: "basketball",   hebrew: "×›×“×•×¨×¡×œ",        options: ["×›×“×•×¨×¡×œ", "×˜× ×™×¡", "×’×•×œ×£", "×‘×™×™×¡×‘×•×œ"] },
      { english: "beautiful",    hebrew: "×™×¤×”",           options: ["×™×¤×”", "×–×•×”×¨", "××˜×¨×™×£", "×§×¡×•×"] },
      { english: "boots",        hebrew: "××’×¤×™×™×",        options: ["××’×¤×™×™×", "× ×¢×œ×™×™×", "×¡× ×“×œ×™×", "× ×¢×œ×™ ×¡×¤×•×¨×˜"] },
      { english: "children",     hebrew: "×™×œ×“×™×",         options: ["×™×œ×“×™×", "××‘×•×’×¨×™×", "×ª×™× ×•×§×•×ª", "× ×•×¢×¨"] },
      { english: "climb",        hebrew: "×œ×˜×¤×¡",          options: ["×œ×˜×¤×¡", "×œ×¨×•×¥", "×œ×©×—×•×ª", "×œ×–×—×•×œ"] },
      { english: "cloud",        hebrew: "×¢× ×Ÿ",          options: ["×¢× ×Ÿ", "×’×©×", "×‘×¨×§", "×¢×¨×¤×œ"] },
      { english: "coat",         hebrew: "××¢×™×œ",          options: ["××¢×™×œ", "×’'×§×˜", "×¡×•×•×“×¨", "×§×¤×•×¦'×•×Ÿ"] },
      { english: "cold",         hebrew: "×§×¨",           options: ["×§×¨", "×—×", "×›×©×”×œ×©×•×Ÿ × ×“×‘×§×ª ×œ×§×¨×—", "×¨×•×ª×—"] },
      { english: "come",         hebrew: "×œ×‘×•×",         options: ["×œ×‘×•×", "×œ×œ×›×ª", "×œ×‘×¨×•×—", "×œ× ×¡×•×¢"] },
      { english: "dress",        hebrew: "×©××œ×”",         options: ["×©××œ×”", "×—×•×œ×¦×”", "× ×•×¦×•×ª ×˜×•×•×¡", "××›× ×¡×™×™×"] },
      { english: "eat",          hebrew: "×œ××›×•×œ",        options: ["×œ××›×•×œ", "×œ×©×ª×•×ª", "×œ×‘×©×œ", "×œ× ×§×•×ª"] },
      { english: "eyes",         hebrew: "×¢×™× ×™×™×",        options: ["×¢×™× ×™×™×", "××•×–× ×™×™×", "××£", "×¤×”"] },
      { english: "father",       hebrew: "××‘×",           options: ["××‘×", "×××", "××—", "×‘×•×‘×•"] },
      { english: "fly a kite",   hebrew: "×œ×”×¢×™×£ ×¢×¤×™×¤×•×Ÿ",  options: ["×œ×˜×•×¡ ×œ×—×œ×œ", "×œ×¢×•×£", "×œ×”×¢×™×£ ×¢×¤×™×¤×•×Ÿ", "×œ×”×•×¦×™× ×™×œ×“ ××”×›×™×ª×”"] },
      { english: "funny",        hebrew: "××¦×—×™×§",        options: ["××¦×—×™×§", "×¢×¦×•×‘", "×¡×‘×‘×” ××’×•×–×™×", "×—×œ×•×˜×¨×”"] },
      { english: "game",         hebrew: "××©×—×§",         options: ["××©×—×§", "×œ×”×ª×—×œ×§ ×¢×œ ×”×©×›×œ", "×¡×¤×•×¨×˜", "××•×–×™×§×”"] },
      { english: "good for you", hebrew: "×›×œ ×”×›×‘×•×“ ×œ×š",  options: ["×›×œ ×”×›×‘×•×“ ×œ×š", "×¨×¢ ×œ×š", "××¦×•×™×Ÿ", "×‘×¡×“×¨"] },
      { english: "home",         hebrew: "×‘×™×ª",          options: ["×‘×™×ª", "××©×¨×“", "×‘×™×ª ×¡×¤×¨", "×—× ×•×ª"] },
      { english: "ice cream",    hebrew: "×’×œ×™×“×”",        options: ["×’×œ×™×“×”", "×¢×•×’×”", "×©×•×§×•×œ×“", "×§×™× ×•×—"] },
      { english: "make",         hebrew: "×œ×¢×©×•×ª",        options: ["×œ×¢×©×•×ª", "×œ×”×›×•×ª", "×œ×‘×“×•×§", "×œ×‘×§×©"] },
      { english: "mother",       hebrew: "×××",          options: ["×××", "××‘×", "××—", "×‘×ª"] },
      { english: "mouth",        hebrew: "×¤×”",           options: ["×¤×”", "×¢×™× ×™×™×", "××•×–× ×™×™×", "×œ×©×•×Ÿ"] },
      { english: "near",         hebrew: "×§×¨×•×‘",         options: ["×§×¨×•×‘", "×¨×—×•×§", "×™×œ×“ ×‘×©× × ×™×¨×•", "××¡×•×‘×š"] },
      { english: "nose",         hebrew: "××£",           options: ["××£", "×¢×™× ×™×™×", "×¤×”", "××•×–× ×™×™×"] },
      { english: "okay",         hebrew: "×‘×¡×“×¨",         options: ["×‘×¡×“×¨", "×œ× ×‘×¡×“×¨", "×›×›×” ×›×›×”", "×™××œ×œ×” ×©××¢× ×• ××•×ª×š"] },
      { english: "old",          hebrew: "×–×§×Ÿ",         options: ["×–×§×Ÿ", "×¦×¢×™×¨", "×›×‘×•×“", "×—×“×©"] },
      { english: "pants",        hebrew: "××›× ×¡×™×™×",      options: ["××›× ×¡×™×™×", "×—×•×œ×¦×”", "×’×¨×‘×™×™×", "× ×¢×œ×™×™×"] },
      { english: "park",         hebrew: "×¤××¨×§",         options: ["×¤××¨×§", "××¨×§ ××¤×•× ×”", "××¨×›×– ×§× ×™×•×ª", "×—× ×•×ª"] },
      { english: "picture",      hebrew: "×ª××•× ×”",        options: ["×ª××•× ×”", "×¦×™×•×¨", "×¤×•×¡×˜×¨", "××¨××”"] },
      { english: "play",         hebrew: "×œ×©×—×§",         options: ["×œ×©×—×§", "×œ×¢×‘×•×“", "×œ×§×¨×•×", "×œ×›×ª×•×‘"] },
      { english: "play football",hebrew: "×œ×©×—×§ ×›×“×•×¨×’×œ",  options: ["×œ×©×—×§ ×›×“×•×¨×’×œ", "×œ×©×—×§ ×›×“×•×¨×¡×œ", "×œ×œ×˜×£ ×¤×™×˜×‘×•×œ", "×œ×©×—×§ ×‘×™×™×¡×‘×•×œ"] },
      { english: "pool",         hebrew: "×‘×¨×™×›×”",        options: ["×‘×¨×™×›×”", "××’×", "× ×”×¨", "×™×"] },
      { english: "read a book",  hebrew: "×œ×§×¨×•× ×¡×¤×¨",     options: ["×œ×§×¨×•× ×¡×¤×¨", "×œ×§×¨×•× ××”××—×‘×¨×ª", "×œ×¦×™×™×¨ ×›×‘×©×”", "×œ×§× ×•×ª ×¡×¤×¨"] },
      { english: "shirt",        hebrew: "×—×•×œ×¦×”",        options: ["×—×•×œ×¦×”", "×©××œ×”", "××¢×™×œ", "××›× ×¡×™×™×"] },
      { english: "shoes",        hebrew: "× ×¢×œ×™×™×",       options: ["× ×¢×œ×™×™×", "××’×¤×™×™×", "×¡× ×“×œ×™×", "× ×¢×œ×™ ×¡×¤×•×¨×˜"] },
      { english: "sky",          hebrew: "×©××™×™×",        options: ["×©××™×™×", "×›×•×›×‘", "×™×¨×—", "×©××©"] },
      { english: "sleep",        hebrew: "×œ×™×©×•×Ÿ",        options: ["×œ×™×©×•×Ÿ", "×œ×”×ª×¢×•×¨×¨", "×œ×—×œ×•×", "×œ× ×•×—"] },
      { english: "snow",         hebrew: "×©×œ×’",         options: ["×©×œ×’", "×’×©×", "×‘×¨×“ ×‘×˜×¢× ×’×•×™××‘×”", "×¢×¨×¤×œ"] },
      { english: "socks",        hebrew: "×’×¨×‘×™×™×",       options: ["×’×¨×‘×™×™×", "××›× ×¡×™×™×", "×—×•×œ×¦×”", "× ×¢×œ×™×™×"] },
      { english: "spring",       hebrew: "××‘×™×‘",         options: ["××‘×™×‘", "×§×™×¥", "×¡×ª×™×•", "×—×•×¨×£"] },
      { english: "stand",        hebrew: "×œ×¢××•×“",        options: ["×œ×¢××•×“", "×œ×©×‘×ª", "×œ×©×›×‘", "×œ×¨×•×¥"] },
      { english: "store",        hebrew: "×—× ×•×ª",         options: ["×—× ×•×ª", "××¡×¢×“×”", "×‘×™×ª ×¡×¤×¨", "×¤××¨×§"] },
      { english: "summer",       hebrew: "×§×™×¥",         options: ["×§×™×¥", "××‘×™×‘", "×¡×ª×™×•", "×—×•×¨×£"] },
      { english: "sunny",        hebrew: "×©××©×™",        options: ["×©××©×™", "××¢×•× ×Ÿ", "×’×©×•×", "×§×¨"] },
      { english: "they",         hebrew: "×”×",           options: ["×”×", "×× ×™", "××ª×”", "×”×™×"] },
      { english: "too",          hebrew: "×’×",          options: ["×’×", "××¢×˜", "×‘×“×™×•×§", "×¨×§"] },
      { english: "tree",         hebrew: "×¢×¥",           options: ["×¢×¥", "×©×™×—", "×¤×¨×—", "×¢×œ×”"] },
      { english: "wall",         hebrew: "×§×™×¨",          options: ["×§×™×¨", "×ª×§×¨×”", "×¨×¦×¤×”", "×“×œ×ª"] },
      { english: "warm",         hebrew: "×—×",           options: ["×—×", "×§×¨", "×ª×•×œ×¢×ª ×¤×™×¨×•×ª", "×¦×•× ×Ÿ"] },
      // Additional words to reach 62 entries:
      { english: "Favorite",     hebrew: "××•×¢×“×£",       options: ["××•×¢×“×£", "× ××”", "××”×•×‘", "××œ×¤×¤×•×Ÿ ×¡×¤×•×¨×˜"] },
      { english: "Meet",         hebrew: "×œ×¤×’×•×©",       options: ["×œ×¤×’×•×©", "×œ×”×™×¤×’×©", "×œ×”×ª×¤×¨×“", "×œ×”×ª×¢×œ×"] },
      { english: "Swim",         hebrew: "×œ×©×—×•×ª",       options: ["×œ×©×—×•×ª", "×œ×¨×•×¥", "×œ×˜×¤×¡", "×œ×§×¤×•×¥"] },
      { english: "Sandwiches",   hebrew: "×¡× ×“×•×•×™×¦×™×",    options: ["×¡× ×“×•×•×™×¦×™×", "×”××‘×•×¨×’×¨", "×¤×™×¦×”", "××•×§×¤×¥"] },
      { english: "Tuna",         hebrew: "×˜×•× ×”",        options: ["×˜×•× ×”", "××§×” ×¤×§×”", "×§×¨×¤×™×•×Ÿ", "×“×’"] },
      { english: "Salad",        hebrew: "×¡×œ×˜",         options: ["×¡×œ×˜", "××¨×§", "×× ×” ×—××”", "×§×™× ×•×—"] },
      { english: "Weather",      hebrew: "××–×’ ××•×•×™×¨",   options: ["××–×’ ××•×•×™×¨", "××§×œ×™×", "×˜××¤×¨×˜×•×¨×”", "×œ×—×•×ª"] },
      { english: "With",         hebrew: "×¢×",          options: ["×¢×", "×‘×œ×™", "×¢×œ", "×¢×“"] },
      { english: "Today",        hebrew: "×”×™×•×",        options: ["×”×™×•×", "××—×¨", "××ª××•×œ", "×¢×›×©×™×•"] },
      { english: "Can",          hebrew: "×™×›×•×œ",        options: ["×™×›×•×œ", "×¨×•×¦×”", "×¦×¨×™×š", "××•×œ×™"] },
      { english: "Can't",        hebrew: "×œ× ×™×›×•×œ",     options: ["×œ× ×™×›×•×œ", "×™×›×•×œ", "×¨×•×¦×”", "×¦×¨×™×š"] },
      { english: "Example",      hebrew: "×“×•×’××”",       options: ["×“×•×’××”", "××•×¤×ª", "×ª×‘× ×™×ª", "××•×¤×¡×™ ×“×™×™×–×™"] }
    ];
    
    /*********************************************************************
     * Vocabulary Set Management (each set is an object with { name, words })
     *********************************************************************/
    let vocabSets = [];
    let currentVocabulary = [];
    
    function loadVocabSets() {
      const stored = localStorage.getItem("vocabSets");
      if (stored) {
        try {
          vocabSets = JSON.parse(stored);
        } catch (e) {
          console.error("Error loading vocabulary sets from localStorage", e);
          vocabSets = [];
        }
      }
      if (!vocabSets || vocabSets.length === 0) {
        vocabSets = [{
          name: "××•×¦×¨ ××™×œ×™× ×‘×¨×™×¨×ª ××—×“×œ",
          words: defaultVocabulary
        }];
        saveVocabSets();
      }
      currentVocabulary = vocabSets[vocabSets.length - 1].words;
      updateVocabSelect();
    }
    
    function saveVocabSets() {
      localStorage.setItem("vocabSets", JSON.stringify(vocabSets));
    }
    
    function updateVocabSelect() {
      const select = document.getElementById("vocabSelect");
      select.innerHTML = "";
      vocabSets.forEach((set, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = set.name;
        if (index === vocabSets.length - 1) {
          option.selected = true;
        }
        select.appendChild(option);
      });
    }
    
    /*********************************************************************
     * Vocabulary Upload Panel Management
     *********************************************************************/
    document.getElementById("loadVocabBtn").addEventListener("click", function() {
      const nameInput = document.getElementById("vocabName").value.trim();
      const vocabName = nameInput ? nameInput : "×¡×˜ ××•×¦×¨ ××™×œ×™× ×—×“×©";
      const fileInput = document.getElementById("vocabUpload");
      if (fileInput.files.length === 0) {
        alert("× × ×œ×‘×—×•×¨ ×§×•×‘×¥ JSON ×¢× ××•×¦×¨ ×”××™×œ×™×");
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const parsed = JSON.parse(e.target.result);
          let wordsArray = [];
          if (Array.isArray(parsed)) {
            wordsArray = parsed;
          } else if (parsed.words && Array.isArray(parsed.words)) {
            wordsArray = parsed.words;
          } else {
            alert("××‘× ×” ×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ. ×™×© ×œ×•×•×“× ×©××“×•×‘×¨ ×‘××¢×¨×š ××• ×‘××•×‘×™×™×§×˜ ×¢× 'words'.");
            return;
          }
          const newSet = {
            name: vocabName,
            words: wordsArray
          };
          vocabSets.push(newSet);
          currentVocabulary = newSet.words;
          saveVocabSets();
          updateVocabSelect();
          alert("×¡×˜ ××•×¦×¨ ××™×œ×™× ×”×•×¢×œ×” ×‘×”×¦×œ×—×”!");
          startGame();
          hideUploadPanel();
        } catch (error) {
          alert("×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥: " + error.message);
        }
      };
      reader.readAsText(file);
    });
    
    document.getElementById("vocabSelect").addEventListener("change", function() {
      const selectedIndex = parseInt(this.value, 10);
      if (!isNaN(selectedIndex) && vocabSets[selectedIndex]) {
        currentVocabulary = vocabSets[selectedIndex].words;
        startGame();
      }
    });
    
    /*********************************************************************
     * Trivia Game Code (10-Question Game with End-of-Round Feedback)
     *********************************************************************/
    let gameWords = [];          
    let currentQuestionIndex = 0;
    let score = 0;
    const totalQuestionsPerRound = 10;
    
    // Global variables for speech synthesis
    let soundEnabled = true;           // Default: sound on
    let currentDisplayedWord = "";     // Holds the currently displayed English word
    
    // Function to speak a word using the Web Speech API
    function speakWord(word) {
      if (!soundEnabled) return;
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }
    
    // Select exactly 10 random words from currentVocabulary
    function selectGameWords() {
      const vocabCopy = [...currentVocabulary];
      gameWords = [];
      const questionsCount = Math.min(totalQuestionsPerRound, vocabCopy.length);
      for (let i = 0; i < questionsCount; i++) {
        const randomIndex = Math.floor(Math.random() * vocabCopy.length);
        gameWords.push(vocabCopy.splice(randomIndex, 1)[0]);
      }
    }
    
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    function displayQuestion() {
      if (currentQuestionIndex >= gameWords.length) {
        endRound();
        return;
      }
      const currentWord = gameWords[currentQuestionIndex];
      currentDisplayedWord = currentWord.english;
      // Build the question HTML with the English word and a sound toggle icon
      const englishHTML = `<p>×¤×™×¨×•×© ×”××™×œ×”</p>
                           <p id="englishWord" style="cursor: pointer;">
                             <b>${currentWord.english}</b>
                             <span id="soundToggle" style="cursor: pointer;">${soundEnabled ? "ğŸ”Š" : "ğŸ”‡"}</span>
                           </p>`;
      document.getElementById('questionText').innerHTML = englishHTML;
      
      // Attach event listener for repeating speech when clicking on the english word (excluding the toggle)
      document.getElementById("englishWord").addEventListener("click", function(event) {
        // Prevent click on the sound icon from triggering this listener
        if (event.target.id !== "soundToggle") {
          speakWord(currentDisplayedWord);
        }
      });
      
      // Attach event listener for the sound toggle icon
      document.getElementById("soundToggle").addEventListener("click", function(event) {
        event.stopPropagation(); // Prevent parent click event
        soundEnabled = !soundEnabled;
        this.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”‡";
      });
      
      document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
      document.getElementById('totalQuestions').textContent = totalQuestionsPerRound;
      
      let options = [...currentWord.options];
      options = shuffleArray(options);
      
      const optionsList = document.getElementById('optionsList');
      optionsList.innerHTML = '';
      options.forEach(option => {
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.onclick = () => handleAnswer(option, btn, currentWord);
        li.appendChild(btn);
        optionsList.appendChild(li);
      });
      document.getElementById('feedbackMessage').textContent = '';
      
      // Automatically speak the word when displayed
      speakWord(currentDisplayedWord);
    }
    
    function handleAnswer(selectedOption, btn, currentWord) {
      const buttons = document.querySelectorAll('.option-btn');
      buttons.forEach(button => button.disabled = true);
    
      let delay = 1200;
      if (selectedOption === currentWord.hebrew) {
        btn.classList.add('correct');
        score++;
        document.getElementById('feedbackMessage').textContent = "×™×¤×”! ×ª×©×•×‘×” × ×›×•× ×”.";
      } else {
        btn.classList.add('wrong');
        buttons.forEach(button => {
          if (button.textContent === currentWord.hebrew) {
            button.classList.add('correct');
          }
        });
        document.getElementById('feedbackMessage').textContent = `×ª×©×•×‘×” ×©×’×•×™×”. ×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${currentWord.hebrew}`;
        delay = 2300;
      }
      document.getElementById('score').textContent = score;
      updateLocalStorage(selectedOption === currentWord.hebrew);
    
      setTimeout(() => {
        currentQuestionIndex++;
        displayQuestion();
      }, delay);
    }
    
    function updateLocalStorage(isCorrect) {
      let totalQuestions = parseInt(localStorage.getItem('totalQuestions') || '0', 10);
      let totalCorrect = parseInt(localStorage.getItem('totalCorrect') || '0', 10);
      totalQuestions++;
      if (isCorrect) {
        totalCorrect++;
      }
      localStorage.setItem('totalQuestions', totalQuestions);
      localStorage.setItem('totalCorrect', totalCorrect);
    }
    
    function endRound() {
      document.getElementById('questionText').textContent = "×¡×™×™××ª ××ª ×”×¡×˜!";
      document.getElementById('optionsList').innerHTML = '';
      
      let feedback;
      if (score <= 3) {
        feedback = "× ×¡×™×ª ×™×¤×”! ×˜×•×‘ ×©×™×© ×”×¨×‘×” ×œ××Ÿ ×œ×”×©×ª×¤×¨!";
      } else if (score <= 5) {
        feedback = "×œ× ×¨×¢! ××‘×œ ××¤×©×¨ ×œ×©××•×£ ×œ×™×•×ª×¨!";
      } else if (score <= 7) {
        feedback = "×× ×™ ×§×•×¨× ×œ×–×” ×ª×•×¦××” ×¡×‘×™×¨×” ×¤×œ×•×¡! ××–×”×™× ××ª ×”×¤×•×˜× ×¦×™××œ ×©×œ×š!";
      } else if (score <= 9) {
        feedback = "×”×•×¤×”! × ×”×™×” ×œ×™ ×—×! ×–×” ×“×™ ×§×¨×•×‘ ×œ××¦×•×™×Ÿ!";
      } else if (score === 10) {
        feedback = "××¦×•×™×Ÿ! ×›×œ ×”×ª×©×•×‘×•×ª × ×›×•× ×•×ª! ×©×•×•×” ×œ×”×©×§×™×¢ ×‘×š!";
      }
      
      document.getElementById('feedbackMessage').textContent = feedback;
      document.getElementById('restartBtn').style.display = 'inline-block';
    }
    
    function startGame() {
      score = 0;
      currentQuestionIndex = 0;
      document.getElementById('score').textContent = score;
      document.getElementById('restartBtn').style.display = 'none';
      selectGameWords();
      displayQuestion();
    }
    
    /*********************************************************************
     * Upload Panel Management (show/hide)
     *********************************************************************/
    function showUploadPanel() {
      document.getElementById("uploadPanel").style.display = "block";
    }
    function hideUploadPanel() {
      document.getElementById("uploadPanel").style.display = "none";
    }
    document.getElementById("hamburgerMenu").addEventListener("click", showUploadPanel);
    document.getElementById("closeUploadPanel").addEventListener("click", hideUploadPanel);
    
    /*********************************************************************
     * Initial Load and Game Start
     *********************************************************************/
    window.onload = function() {
      loadVocabSets();
      startGame();
    };
    document.getElementById('restartBtn').addEventListener('click', startGame);
  </script>
</body>
</html>
